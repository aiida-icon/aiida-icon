
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://aiida-icon.github.io/aiida-icon/">
      
      
      
        <link rel="next" href="recipes/">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>AiiDA-ICON Documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aiida-icon-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="AiiDA-ICON Documentation" class="md-header__button md-logo" aria-label="AiiDA-ICON Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AiiDA-ICON Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="AiiDA-ICON Documentation" class="md-nav__button md-logo" aria-label="AiiDA-ICON Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    AiiDA-ICON Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    <span class="md-ellipsis">
      
        About
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quickstart
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quickstart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-aiida" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup AiiDA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-productive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get Productive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Get Productive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-from-all-local-namelist-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run from all local namelist files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-an-icon-job-from-just-a-master-namelist-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run an ICON job from just a master namelist file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-icon-job-with-provenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run ICON job with provenance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recipes-for-specific-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recipes for specific use cases
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="recipes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cookbook
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about" class="md-nav__link">
    <span class="md-ellipsis">
      
        About
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quickstart
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quickstart">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-aiida" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup AiiDA
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-productive" class="md-nav__link">
    <span class="md-ellipsis">
      
        Get Productive
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Get Productive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-from-all-local-namelist-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run from all local namelist files
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-an-icon-job-from-just-a-master-namelist-file" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run an ICON job from just a master namelist file
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-icon-job-with-provenance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Run ICON job with provenance
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recipes-for-specific-use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recipes for specific use cases
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  
  




<h1 id="aiida-icon-documentation">AiiDA-ICON - Documentation<a class="headerlink" href="#aiida-icon-documentation" title="Permanent link">&para;</a></h1>
<h2 id="about">About<a class="headerlink" href="#about" title="Permanent link">&para;</a></h2>
<p>aiida-icon is a plugin to the <a href="https://www.aiida.net" title="AiiDA - Workflow Manager">AiiDA</a> scientific workflow manager.
It allows users of the <a href="https://icon-model.org" title="ICON - Climate &amp; Weather Model">ICON</a> weather &amp; climate model to run
experiment workflows which:</p>
<ul>
<li>remember all the inputs and configurations they were run with</li>
<li>do not require careful file-structure setup on the target machine before running</li>
<li>can be shared and adapted by colleagues in a group</li>
<li>are reproducible</li>
</ul>
<h2 id="quickstart">Quickstart<a class="headerlink" href="#quickstart" title="Permanent link">&para;</a></h2>
<p>For users who do not want or need to learn how to leverage the full versatility of <a href="https://www.aiida.net" title="AiiDA - Workflow Manager">AiiDA</a>,
<a href="https://github.com/C2SM/Sirocco" title="Sirocco - dynamic Climate &amp; Weather Workflows">Sirocco</a> provides a declarative way to describe Climate &amp; Weather workflows. This makes
usage similar to other, field-specific workflow managers, without sacrificing the benefits
of <a href="https://www.aiida.net" title="AiiDA - Workflow Manager">AiiDA</a>. Many of the steps below will still apply if you want to use <a href="https://github.com/C2SM/Sirocco" title="Sirocco - dynamic Climate &amp; Weather Workflows">Sirocco</a>,
except that installing <a href="https://github.com/C2SM/Sirocco" title="Sirocco - dynamic Climate &amp; Weather Workflows">Sirocco</a> will install aiida-icon as a dependency automatically.</p>
<p>Here's how to get started with a minimal setup:</p>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create and activate a python environment from which you will run your experiments. Conda, Virtualenvwrapper, venv etc are all fine ways to achieve that. In case you expect to be developing workflows and submission scripts, which you would like to be portable between machines, you should consider a version controlled project using a project manager like <code>uv</code>, <code>hatch</code> or <code>poetry</code>.</p>
</li>
<li>
<p>Run <code>pip install aiida-icon</code> to install aiida-icon, AiiDA and all their dependencies. In the case of a project manager like <code>hatch</code>, use <code>hatch add aiida-icon</code> or your project manager's equivalent.</p>
</li>
</ol>
<h3 id="setup-aiida">Setup AiiDA<a class="headerlink" href="#setup-aiida" title="Permanent link">&para;</a></h3>
<p>The following is a summary of the <a href="https://aiida.readthedocs.io/projects/aiida-core/en/stable/installation/guide_quick.html">AiiDA Quick Install Guide</a> and the <a href="https://aiida.readthedocs.io/projects/aiida-core/en/stable/howto/run_codes.html">AiiDA How To Run External Codes</a>.</p>
<ol>
<li>
<p>Install and run <code>rabbitmq 3.8.5</code>, either as a system service or as a docker image.</p>
</li>
<li>
<p>Run <code>verdi presto</code> to create your AiiDA profile</p>
</li>
<li>
<p>Run <code>verdi computer setup</code> to create a record of the target (HPC) machine you will use. This is not necessary if you are planning to run <a href="https://icon-model.org" title="ICON - Climate &amp; Weather Model">ICON</a> on your local machine, as <code>verdi presto</code> has already created a record called <code>localhost</code> for your local machine. Here you will give that record a name, later referred to as <code>&lt;computername&gt;</code>.</p>
</li>
<li>
<p>Allow AiiDA to connect to your target machine.</p>
</li>
<li>In general: run <code>verdi computer configure ssh &lt;computername&gt;</code> to allow AiiDA to connect to the target machine.</li>
<li>For CSCS ALPS clusters: the recommended way is to<ol>
<li>Run <code>pip install aiida-firecrest</code></li>
<li>Set up firecrest connectivity to your target cluster using the <a href="https://confluence.cscs.ch/display/KB/FirecREST+for+Alps">CSCS Knowledge Base Article</a></li>
<li>Run <code>verdi computer configure firecrest &lt;computername&gt;</code></li>
</ol>
</li>
<li>Run <code>verdi computer test &lt;computername&gt;</code> to make sure a connection can be established.</li>
</ol>
<!-- prettier-ignore-start -->
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You have to choose in step 3 already when you set "Transport" and "Scheduler", whether you will use "ssh" or "firecrest" in step 4.
Pick "core.ssh" for transport and combine it with any of the available schedulers to connect with ssh OR pick "firecrest" for <strong>both</strong>
(firecrest is used for both file transport as well as communication with the scheduler).</p>
</div>
<!-- prettier-ignore-end -->

<ol>
<li>Run <code>verdi code create icon</code> to set up an ICON executable on the computer you created in the previous step. Consult the AiiDA documentation for details.</li>
</ol>
<h3 id="get-productive">Get Productive<a class="headerlink" href="#get-productive" title="Permanent link">&para;</a></h3>
<p>Now you are ready to either run bare-bones ICON jobs (checkout the <code>examples/</code> directory for inspiration), or to develop AiiDA workflows incorporating ICON jobs.</p>
<h4 id="run-from-all-local-namelist-files">Run from all local namelist files<a class="headerlink" href="#run-from-all-local-namelist-files" title="Permanent link">&para;</a></h4>
<p>This is somewhat the best case for usability: AiiDA will remember all the parameters for you, as it stores the contents of the namelist files at the point of submitting the run.</p>
<p>Of course, this requires that your master namelist specifies to look for model namelists in the work directory of the job. AiiDA will not upload files to elsewhere. For example:</p>
<pre><code>&amp;master_nml
  model_base_dir = models   ! or ./models, may not be an absolute path
  ...
/
...
&amp;master_model_nml
  model_name = &quot;atm&quot;
  model_namelist_filename = &quot;&lt;path&gt;/atm.namelist&quot;   ! referencing the relative &quot;model_base_dir&quot; as &quot;&lt;path&gt;&quot;
  model_type = 1
  ...
/
...
</code></pre>
<p>This will cause AiiDA-ICON to upload a copy of your local "atm.namelist" into the "models" sub directory of the work directory. This works for multiple model namelists too.</p>
<pre><code class="language-python">#!verdi run
from aiida import orm
from aiida_icon.calculations import IconCalculation

code = orm.load_code(&quot;myicon@myhpc&quot;)
builder = IconCalculation.get_builder()
builder.code = code
builder.master_namelist = orm.SinglefileData(&quot;/path/to/my/master.nml&quot;)
builder.models.atm = orm.SinglefileData(&quot;/path/to/my/atm.namelist&quot;)
builder.submit() # or .run() if you have not set up rabbitmq for your AiiDA profile
</code></pre>
<p>In this case, AiiDA keeps a snapshot of the contents of all the model namelist files for later reference - freeing you up to do with the files themselves as you wish.</p>
<h4 id="run-an-icon-job-from-just-a-master-namelist-file">Run an ICON job from just a master namelist file<a class="headerlink" href="#run-an-icon-job-from-just-a-master-namelist-file" title="Permanent link">&para;</a></h4>
<p>The absolute minimum requirement is that you have the contents of your master namelist file available
on the computer you submit from.</p>
<p>Assume you have one that looks as follows:</p>
<pre><code>&amp;master_nml
  model_base_dir = /homes/myuser/models
  ...
/
...
&amp;master_model_nml
  model_name = &quot;atm&quot;
  model_namelist_filename = &quot;&lt;path&gt;/atm.namelist&quot;
  model_type = 1
  ...
/
...
</code></pre>
<p>This has to be in a file local to where you are running AiiDA.
And you have the appropriate files in the appropriate places on your remote machine.
You also have a code set up on your hpc system (named "myhpc" in your DB) and you named it "myicon".</p>
<p>You can submit the job with the following script:</p>
<pre><code class="language-python">#!verdi run
from aiida import orm
from aiida_icon.calculations import IconCalculation

code = orm.load_code(&quot;myicon@myhpc&quot;)
builder = IconCalculation.get_builder()
builder.code = code
builder.master_namelist = orm.SinglefileData(&quot;/path/to/my/master.nml&quot;)
builder.submit() # or .run() if you have not set up rabbitmq for your AiiDA profile
</code></pre>
<p>Note that this will do two things with your master namelist file:</p>
<ol>
<li>It will keep the contents in your AiiDA database, forever connected to this run. You can change the file safely later and still inspect what it looked like when you ran this.</li>
<li>It will upload a copy of it to the work directory of the job on your HPC machine (whether that be a remote one or your laptop), where it will also stay unchanged until cleaned up by you or by some file system policy.</li>
</ol>
<p>This means you keep a record of the exact parameters used, even if you change the file. It also means you can use that same set of parameters in future runs, even if the file is gone from your file system.</p>
<h4 id="run-icon-job-with-provenance">Run ICON job with provenance<a class="headerlink" href="#run-icon-job-with-provenance" title="Permanent link">&para;</a></h4>
<p>Using the same ICON job as above: you might want to consider tracking the model namelist files your run is using inside the AiiDA graph. This makes it convenient to later inspect or retrieve them, without opening up the master namelist file first.</p>
<pre><code class="language-python">...

builder.master_namelist = orm.SinglefileData(&quot;/path/to/my/master.nml&quot;)
builder.models.atm = orm.RemoteData(code.computer, remote_path=&quot;/homes/myuser/models/atm.namelist&quot;)  # the 'remote_path' has to exactly match what the master namelist specifies
</code></pre>
<p>In this case, no additional files are moved, the <code>.models.atm</code> input is simply there to keep a record of what file path you used in the database. Looking back later, there is no way to even know if the file has been changed after this was run.</p>
<h2 id="recipes-for-specific-use-cases">Recipes for specific use cases<a class="headerlink" href="#recipes-for-specific-use-cases" title="Permanent link">&para;</a></h2>
<p>Find detailed instructions for specific known usecases <a href="recipes/">here</a></p>







  
  




  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": [], "search": "assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>